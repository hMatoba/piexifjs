sudo: false

language: node_js
node_js:
  - "10"
  # - "9"
  # - "8"

before_script:
  - npm install

script:
  - npm run build
  - npm run test

before_deploy:
  - git checkout -b release-test  # when release 2.0, change to master
  - mkdir piexifjs
  - cp ./dist/piexifjs.js ./piexifjs/
  - cp ./README.rst ./piexifjs/
  - cp ./LICENSE.txt ./piexifjs/
  - zip -r piexifjs.zip ./piexifjs
deploy:
  provider: releases
  api_key: "${GITHUB_OAUTH_TOKEN}"
  file: piexifjs.zip
  skip_cleanup: true
  on:
    all_branches: true
    condition: $TRAVIS_BRANCH = $TRAVIS_TAG